## rc_dex微服务搭建步骤
1. 在`rc_dex`目录下执行`go mod init module-name`,生成`go.mod`文件
2. 创建网关：执行`goctl gateway --dir gateway`
    ```
    gateway/
    ├── etc/                 # 配置文件目录
    │   ├── gateway.yaml     # 服务配置文件
    │── main.go              # 服务主入口，服务启动文件，使用它将服务启动起来
    ```
3. 创建一个微服务模块，使用`goctl rpc new`命令：

   `goctl rpc new consumer`: `consumer `模块，用来消费helius的数据
4. 执行`go run consumer.go`
    ```
    MacBook-Pro:consumer ~$ go run consumer.go
    Starting rpc server at 0.0.0.0:8080...
    ```
5. 安装bloomRPC，基础的客户端测试工具（https://github.com/bloomrpc/bloomrpc/releases）

    导入`consumer.proto`文件

    修改端口为`127.0.0.1:8080`，与上面的端口保持一致

    点击运行，返回：
    ```
    {
    "pong": ""
    }
    ```
    `/ping`的实现逻辑在`./internal/logic/pinglogic.go`，修改为：
    ```go
    return &consumer.Response{Pong: "hello world of logic layer"}, nil
    ```
    （由于没有热部署）ctrl+C关掉服务，再启动，再点击运行，返回：
    ```
    {
    "pong": "hello world of logic layer"
    }
    ```

## gRPC微服务调用
[gRPC gateway 官网介绍](https://go-zero.dev/docs/tutorials/gateway/grpc)

前面是基于proto文件进行的RPC的方式调用，并没有网关的参与，现在希望通过http请求或者浏览器访问或者curl请求到，完整流程：
```
   (HTTP请求)
前端  -->  网关  -->  RPC服务 -->  后端proto
```

### 步骤：
1. 新建proto文件`hello_server.proto`

2. 执行如下指令生成 protoDescriptor：
    ```bash
    $ protoc --descriptor_set_out=gateway/hello_server.pb hello_server.proto
    ```
    在`gateway`目录下生成了`hello_server.pb`的二进制文件

3. 执行如下指令，基于proto文件生成gRPC服务代码：
   相当于基于proto文件生成了一个新服务出来（跟consumer一样的服务）
    ```bash
    # hello_server是生成的文件存放的文件目录
    $ goctl rpc protoc hello_server.proto --go_out=hello_server --go-grpc_out=hello_server --zrpc_out=hello_server
    ```

4. 到`hello-server`文件夹下将hello服务运行起来
    ```bash
    MacBook-Pro:rc_dex ~$ cd hello_server
    MacBook-Pro:hello_server ~$ go run helloserver.go 
    Starting rpc server at 0.0.0.0:8080...
    ```
5. 进入`gateway/etc/gateway.yaml`，将mapping映射打开：
    ```bash
    ProtoSets:
      - hello_server.pb # 修改为hello_server.pb
    # Mappings can also be written in proto options
    Mappings: # routes mapping
      - Method: get
        Path: /ping  # 通过请求gateway_host:gateway_port/ping，网关会将请求映射到RpcPath上
        RpcPath: hello.Hello/Ping # 这里映射的是hello_server.proto文件中的包名hello+service Hello中的Ping方法（第5、20、22行）
    ```
6. 新建终端窗口，将gateway服务运行起来
    ```bash
    MacBook-Pro:gateway ~$ go run main.go
    {"@timestamp":"2025-11-15T20:32:25.020+08:00","caller":"stat/usage.go:82","content":"CPU: 0m, MEMORY: Alloc=2.5Mi, TotalAlloc=4.3Mi, Sys=13.6Mi, NumGC=2","level":"stat"}
    {"@timestamp":"2025-11-15T20:32:25.030+08:00","caller":"load/sheddingstat.go:61","content":"(api) shedding_stat [1m], cpu: 0, total: 0, pass: 0, drop: 0","level":"stat"}
    ```
7. 再新建终端窗口执行curl命令
    ```bash
    MacBook-Pro:dex_amm ~$ curl http://localhost:8888/ping
    
    {"msg":"hello server of logic layer"}
    ```

以上，说明通过http请求实现了微服务的访问。